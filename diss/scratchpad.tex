\documentclass{report}
\input{header.tex}
\begin{document}
\section{Introduce Substitutions}
\subsection{Substitutions as SNOC lists}

\begin{equation}
    \si \gens \nil \mid \si, x \setto v
\end{equation}

\paragraph{Definition of $\si$}
\subsection{Trivial Properties of substitutions}
\paragraph{$\fv{\si}$}
\begin{align}
    \fv{\nil} &= \emptyset\\
    \fv{\si, x\setto v} &= \fv{\si}\cup\fv{v}
\end{align}
\paragraph{$\dom{\si}$}
\begin{align}
    \dom{\nil} & = \emptyset\\
    \dom{\si, x\setto v} & = \dom{\si}\cup\left\{x\right\}
\end{align}

\paragraph{$x \# \si$}
\begin{equation}
    x \# \si \Leftrightarrow x\notin(\fv{\si}\cup\dom{\si`})
\end{equation}

\subsection{Effect of substitutions}
\subsection{Well Formedness}
\subsection{Simple Properties Of Substitution}
If $\typerelation{\G'}{\si}{\G}$ then:
\todo{Number these}
\begin{itemize}
    \item $\ok{\G}$ and $\ok{\G'}$
    \item $\wrel{\w}{\G''}{\G'}$ implies $\typerelation{\G''}{\si}{\G}$
%       \item $\x \notin (\dom{\G} \union \dom{\G''})$ implies $\typerelation{(\G', x: A)}{(\si, x \setto x)}{(\gax)}$
\end{itemize}

\section{Substitution Preserves Typing}
\todo{State property}
\todo{Proof by induction overtype relation}
\section{Semantics of Substitution}
\subsection{Denotation of Substitutions}
\todo{Fill in from p98}
\subsection{Lemma}
\todo{Fill in from p98}
\subsection{Substitution Theorem}

\todo{There is Tikz code here to draw the Substitution Theorem diagram, but it compiles v slowly}
If $\gtyperelation{t}{\tau}$ and $\typerelation{\G'}{\si}{\G}$ then
%\begin{tikzcd}[ampersand replacement=\&]
%    \G' 
%        \arrow [rr, "\deno{\typerelation{\G'}{\si}{\G}}"] 
%        \arrow [rrd, "\deno{\typerelation{\G'}{t\sub{\si}}{\tau}} "] \&\&
%    \G 
%        \arrow [d, "\deno{\gtyperelation{t}{\tau}}"]
%    \\
%    \& \&\deno{T}
%\end{tikzcd}
\section{Single Substitution}    
\end{document}
