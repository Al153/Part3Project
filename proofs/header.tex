
%% Don't import the header multiple times

\ifdefined\HEADERIMPORTED
\else
\newcommand\HEADERIMPORTED[0]{This file is HEADERIMPORTED}
\usepackage{amssymb}

\usepackage{amsmath}


% For typesetting tree rules
\usepackage{mathpartir}

% For colouring code
\usepackage{xcolor}


\usepackage{array}   % for \newcolumntype macro
\usepackage{tikz-cd}
\usepackage{tabstackengine}
\usepackage{breqn}
\usepackage{stmaryrd}

\usepackage{float} % extra options for figure placement

% For drawing boxed
\usepackage{framed}

% for code fragments + highlighting
\usepackage{listings}

% For roman numerals
\usepackage{enumitem}


\usepackage{amsthm}
%Theorems
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\ifdefined\PRESENTATIONMODE
\else
\usepackage[a4paper,includeheadfoot,margin=2.54cm]{geometry}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}{Definition}[section]

\newtheorem{aside}{Aside}[section]
\newtheorem{property}[theorem]{Property}
\theoremstyle{definition}
\fi



\usepackage{tikz}

\definecolor{grey}{rgb}{0.75, 0.75, 0.75}
\definecolor{DarkGreen}{rgb}{0.1, 0.6, 0.1}

\usetikzlibrary{shapes.geometric,fit}
\usetikzlibrary{arrows,automata,positioning}
\usetikzlibrary{decorations.pathreplacing,calc}



\setstackEOL{\cr}
\setstackgap{L}{\normalbaselineskip}

\newcommand\todo[1]{\textbf{TODO: #1}}
\newcommand\needsRef[1]{\textbf{Reference Needed: (#1)}}
\newcommand\fixLayout[1]{\textbf{Fix Layout: #1}}


%% Rule Names
% Prefixes
\newcommand{\tprefix}[0]{T-}
\newcommand{\eprefix}[0]{E-}
\newcommand{\sprefix}[0]{S-}
\newcommand\equationalprefix[0]{Eq-}
\newcommand\envprefix[0]{Env-}
\newcommand\pprefix[0]{\eprefix\envprefix}

\newcommand\subprefix[0]{Sb-}
\newcommand\weakenprefix[0]{Wk-}

% Base  rule names
\newcommand\basenil[0]{Nil}
\newcommand\baseextend[0]{Extend}

\newcommand{\baseground}[0]{Ground}
\newcommand{\baseweaken}[0]{Weaken}
\newcommand{\basevar}[0]{Var}
\newcommand\basefn[0]{Fn}
\newcommand\baseeffect[0]{Effect}
\newcommand\basequant[0]{Quantification}


\newcommand\baseunit[0]{Unit}
\newcommand\basetrue[0]{True}
\newcommand\basefalse[0]{False}
\newcommand\baseconst[0]{Const}
\newcommand\basesubtype[0]{Subtype}
\newcommand\basegen[0]{Effect-Gen}
\newcommand\basespec[0]{Effect-Spec}
\newcommand\basereturn[0]{Return}
\newcommand\baseapply[0]{Apply}
\newcommand\baseif[0]{If}
\newcommand\basebind[0]{Bind}

\newcommand\basetransitive[0]{Transitive}
\newcommand\basereflexive[0]{Reflexive}

\newcommand{\baseid}[0]{Id}
\newcommand\baseproject[0]{Project}

% Effect Weakening Rule Names
\newcommand{\eid}[0]{\eprefix\baseid}
\newcommand{\eproject}[0]{\eprefix\baseproject}
\newcommand{\eextend}[0]{\eprefix\baseextend}

% Term Weakening Rule Names
\newcommand{\tid}[0]{\tprefix\baseid}
\newcommand{\tproject}[0]{\tprefix\baseproject}
\newcommand{\textend}[0]{\tprefix\baseextend}

% Effect Substitution Rule Names
\newcommand\esubnil[0]{\eprefix\basenil}
\newcommand\esubextend[0]{\eprefix\baseextend}

% Term Substitution Rule Names

\newcommand\tsubnil[0]{\tprefix\basenil}
\newcommand\tsubextend[0]{\tprefix\baseextend}

% Type environment Rule Names
\newcommand\envnil[0]{\envprefix\basenil}
\newcommand\envextend[0]{\envprefix\baseextend}
% Effect Environment rule names
\newcommand\pnil[0]{\pprefix\basenil}
\newcommand\pextend[0]{\pprefix\baseextend}
% Equational equality rule names
\newcommand{\eqbeta}[0]{\equationalprefix Lambda-Beta}
\newcommand{\eqeta}[0]{\equationalprefix Lambda-Eta}
\newcommand{\eqeffbeta}[0]{\equationalprefix Effect-Beta}
\newcommand{\eqeffeta}[0]{\equationalprefix Effect-Eta}
\newcommand\eqleftunit[0]{\equationalprefix Left-Unit}
\newcommand\eqrightunit[0]{\equationalprefix Right-Unit}
\newcommand\equnitequiv[0]{\equationalprefix Unit}
\newcommand\eqiftrue[0]{\equationalprefix If-True}
\newcommand\eqiffalse[0]{\equationalprefix If-False}
\newcommand\eqifeta[0]{\equationalprefix If-Eta}
\newcommand\eqassociativity[0]{\equationalprefix Associativity}

\newcommand{\eqreflexive}[0]{\equationalprefix\basereflexive}
\newcommand\eqtransitive[0]{\equationalprefix\basetransitive}
\newcommand\eqsymmetric[0]{\equationalprefix Symmetric}

\newcommand\equnit[0]{\equationalprefix\baseunit}
\newcommand\eqtrue[0]{\equationalprefix\basetrue}
\newcommand\eqfalse[0]{\equationalprefix\basefalse}
\newcommand\eqconst[0]{\equationalprefix\baseconst}
\newcommand{\eqvar}[0]{\equationalprefix\basevar}
\newcommand\eqweaken[0]{\equationalprefix\baseweaken}
\newcommand\eqfun[0]{\equationalprefix\basefn}
\newcommand\eqsubtype[0]{\equationalprefix\basesubtype}
\newcommand\eqgen[0]{\equationalprefix\basegen}
\newcommand\eqspec[0]{\equationalprefix\basespec}
\newcommand\eqreturn[0]{\equationalprefix\basereturn}
\newcommand\eqapply[0]{\equationalprefix\baseapply}
\newcommand\eqif[0]{\equationalprefix\baseif}
\newcommand\eqbind[0]{\equationalprefix\basebind}

% Term rule names
\newcommand\vunit[0]{\baseunit}
\newcommand\vtrue[0]{\basetrue}
\newcommand\vfalse[0]{\basefalse}
\newcommand\vconst[0]{\baseconst}
\newcommand{\vvar}[0]{\basevar}
\newcommand\vweaken[0]{\baseweaken}
\newcommand\vfun[0]{\basefn}
\newcommand\vsubtype[0]{\basesubtype}
\newcommand\vgen[0]{\basegen}
\newcommand\vspec[0]{\basespec}
\newcommand\vreturn[0]{\basereturn}
\newcommand\vapply[0]{\baseapply}
\newcommand\vif[0]{\baseif}
\newcommand\vbind[0]{\basebind}

%Effect rule names
\newcommand\eground[0]{\eprefix\baseground}
\newcommand\evar[0]{\eprefix\basevar}
\newcommand\eweaken[0]{\eprefix\baseweaken}
\newcommand\ecompose[0]{\eprefix Compose}

% Type rule names
\newcommand{\tground}[0]{\tprefix\baseground}
\newcommand{\tfun}[0]{\tprefix\basefn}
\newcommand{\teffect}[0]{\tprefix\baseeffect}
\newcommand{\tquant}[0]{\tprefix\basequant}

% Subtyping rule names
\newcommand{\stransitive}[0]{\sprefix\basetransitive}
\newcommand{\sreflexive}[0]{\sprefix\basereflexive}
\newcommand{\sground}[0]{\sprefix\baseground}
\newcommand{\sfun}[0]{\sprefix\basefn}
\newcommand{\seffect}[0]{\sprefix\baseeffect}
\newcommand{\squant}[0]{\sprefix\basequant}


\newcommand{\s}{\;}
\newcommand{\doin}[3]{\texttt{do}\s #1 \leftarrow #2 \s\texttt{in}\s #3\s}
\newcommand\apply[2]{#1\s#2}
\newcommand{\pifthenelse}[4]{\texttt{if}_{\textcolor{purple}{#1}}\s#2\s \texttt{then}\s #3 \s\texttt{else} \s#4\s}
\newcommand\ifthenelse[5]{\pifthenelse{#1, #2}{#3}{#4}{#5}}
\newcommand\const[1]{\texttt{k}^{\color{purple} #1}}
\newcommand\return[1]{\texttt{return} \s#1\s}


\newcommand\lam[3]{\lambda #1 \colon {\color{purple}#2}. #3\s}
\renewcommand\u[0]{\texttt{()}}
\newcommand{\U}[0]{\texttt{Unit}}
\renewcommand\t[0]{\texttt{true}}
\newcommand\f[0]{\texttt{false}}
\newcommand{\B}[0]{\texttt{Bool}}
\newcommand{\G}[0]{\Gamma}
\newcommand\D{\Delta}


% draw type relations
\newcommand{\typerelation}[3]{{\color{DarkGreen}#1} \vdash #2 \colon {\color{blue}#3}}
\newcommand\wellformed[2]{{\color{DarkGreen}#1}\vdash {\color{blue}#2}}
\newcommand\wellformedok[2]{\ok{{\color{DarkGreen}#1}\vdash {\color{blue} #2}}}

\newcommand{\wellformedtype}[2]{\typerelation{#1}{#2}{\type}}
\newcommand{\wellformedeffect}[2]{\typerelation{#1}{#2}{\effect}}
\newcommand{\wellformede}[2]{\wellformedeffect{#1}{#2}}
\newcommand{\wellformedt}[2]{\wellformedtype{#1}{#2}}
\newcommand{\wellformedF}[2]{\typerelation{#1}{#2}{F}}



\newcommand{\gtyperelation}[2]{\typerelation{\G}{#1}{#2}}
 

\newcommand\treerulez[1]{\inferrule{ }{#1}}
\newcommand\treeruleI[2]{\inferrule{#1}{#2}}
\newcommand\treeruleII[3]{\inferrule{#1 \\ #2}{#3}}
\newcommand\treeruleIII[4]{\inferrule{#1 \\ #2 \\ #3}{#4}}
\newcommand\treeruleIV[5]{\inferrule{#1 \\ #2 \\ #3 \\ #4}{#5}}
\newcommand\treeruleV[6]{\inferrule{#1 \\ #2 \\ #3 \\ #4 \\ #5}{#6}}

\newcommand\ntreerulez[2]{(\text{#1})\inferrule{ }{#2}}
\newcommand\ntreeruleI[3]{(\text{#1})\inferrule{#2}{#3}}
\newcommand\ntreeruleII[4]{(\text{#1})\inferrule{#2 \\ #3}{#4}}
\newcommand\ntreeruleIII[5]{(\text{#1})\inferrule{#2 \\ #3 \\ #4}{#5}}
\newcommand\ntreeruleIV[6]{(\text{#1})\inferrule{#2 \\ #3 \\ #4 \\ #5}{#6}}
\newcommand\ntreeruleV[7]{(\text{#1})\inferrule{#2 \\ #3 \\ #4 \\ #5 \\ #6}{#7}}

\newcommand\condtreerulez[3]{(\text{#1})\inferrule{ }{#2}(\text{if } #3)}
\newcommand\condtreeruleI[4]{(\text{#1})\inferrule{#2}{#3}(\text{if } #4)}
\newcommand\condtreeruleII[5]{(\text{#1})\inferrule{#2 \\ #3}{#4}(\text{if } #5)}
\newcommand\condtreeruleIII[6]{(\text{#1})\inferrule{#2 \\ #3 \\ #4}{#5}(\text{if } #6)}
\newcommand\condtreeruleIV[7]{(\text{#1})\inferrule{#2 \\ #3 \\ #4 \\ #5}{#6}(\text{if } #7)}
\newcommand\condtreeruleV[8]{(\text{#1})\inferrule{ #2 \\ #3 \\ #4 \\ #5 \\ #6 }{#7}(\text{if } #8)}



\newcommand{\subtype}[0]{{\color{blue} \leq\colon}}
\newcommand\subeffect[0]{{\color{DarkGreen} \leq}}

\newcommand{\M}[2]{\texttt{M}_{#1}{#2}}

\newcommand\lamtype[3]{#1 \rightarrow \M{#2}{#3}}
\newcommand{\1}[0]{\texttt{1}}

\newcommand\e[0]{\epsilon}

\newcommand{\db}[1]{{\bf [\![}#1{\bf ]\!]}}
\newcommand{\deno}[1]{\db{#1}}
\newcommand\after\circ
\newcommand\term[1]{\langle\rangle_{#1}}

\newcommand\bindmu[0]{\mu}
\newcommand\point[1]{\eta_{#1}}
\newcommand\bind[3]{\bindmu_{#1, #2, #3}}

\newcommand\T[2]{T_{#1}{#2}}

\newcommand\pr[2]{\langle#1, #2\rangle}
\newcommand\finpr[2]{\langle #1\rangle_{#2}}

\newcommand\strengtht[0]{\texttt{t}}
% tensor strength Nat-tran
\newcommand\tstrength[3]{\strengtht_{#1, #2, #3}}

% Id morphism
\newcommand\Id[1]{\texttt{Id}_{#1}}

\newcommand\idg[0]{\Id{\G}}
% beta-eta equivalence
\newcommand\beequiv[0]{\approx}
% Substitutions
\newcommand\si{\sigma}

\newcommand{\sub}[1]{[#1]}
\newcommand{\ssub}[2]{[#2 / #1]}
\newcommand{\ssi}[0]{\sub{\si}}

% beta-eta equivalence relation
\newcommand{\berelation}[4]{\typerelation{#1}{#2 \beequiv #3}{#4}}
\newcommand{\gberelation}[3]{\gtyperelation{#1 \beequiv #2}{#3}}


% Shortcuts for denotational equality
\newcommand{\denoequality}[4]{\deno{\typerelation{#1}{#2}{#4}} = \deno{\typerelation{#1}{#3}{#4}}}
\newcommand{\gdenoequality}[3]{\denoequality{\G}{#1}{#2}{#3}}

% Shorthand for monad types
\newcommand\mea[0]{\M{\e}{A}}
\newcommand\meb[0]{\M{\e}{B}}
\newcommand\mec[0]{\M{\e}{C}}

\newcommand\tea[0]{\T{\e}{A}}
\newcommand\teb[0]{\T{\e}{B}}
\newcommand\tec[0]{\T{\e}{C}}


\newcommand\moa[0]{\M{\1}{A}}
\newcommand\mob[0]{\M{\1}{B}}
\newcommand\moc[0]{\M{\1}{C}}

\newcommand\toa[0]{\T{\1}{A}}
\newcommand\tob[0]{\T{\1}{B}}
\newcommand\toc[0]{\T{\1}{C}}

\newcommand\aeb[0]{\lamtype{A}{\e}{B}}

% Shorthand for Gammas
\newcommand{\gax}[0]{\G, x\colon A}
\newcommand{\gby}[0]{\G, y\colon B}

% reduction function
\newcommand{\reduce}[0]{reduce}



% Combinators for building delta-based tree proof terms
\newcommand{\deltavrule}[4]{
    \ntreeruleII{\vsubtype}{\treeruleI{\D}{\typerelation{#1}{#2}{#3}}}{#3 \subtype #4}{\typerelation{#1}{#2}{#4}}}

\newcommand{\deltavruleprime}[4]{
    \ntreeruleII{\vsubtype}{\treeruleI{\D'}{\typerelation{#1}{#2}{#3}}}{#3 \subtype #4}{\typerelation{#1}{#2}{#4}}}

\newcommand{\deltavruleprimeprime}[4]{
        \ntreeruleII{\vsubtype}{\treeruleI{\D'}{\typerelation{#1}{#2}{#3}}}{#3 \subtype #4}{\typerelation{#1}{#2}{#4}}}
    
\newcommand{\deltacrule}[6]{
            \ntreeruleII{Subeffect}{\treeruleI{\D}{\typerelation{#1}{#2}{\M{#3}{#4}}}}{\subeffecttree{#3}{#4}{#5}{#6}}{\typerelation{#1}{#2}{\M{#5}{#6}}}}
\newcommand{\deltacruleprime}[6]{
    \ntreeruleII{Subeffect}{\treeruleI{\D'}{\typerelation{#1}{#2}{\M{#3}{#4}}}}{
    \subeffecttree{#3}{#4}{#5}{#6}}{\typerelation{#1}{#2}{\M{#5}{#6}}}}
\newcommand{\deltacruleprimeprime}[6]{
    \ntreeruleII{\vsubtype}{\treeruleI{\D''}{\typerelation{#1}{#2}{\M{#3}{#4}}}}{
        \subeffecttree{#3}{#4}{#5}{#6}}{\typerelation{#1}{#2}{\M{#5}{#6}}}}
                            

\newcommand{\p}[0]{\pi_1}
\newcommand{\pp}[0]{\pi_2}

% short-hands for weakening
\newcommand{\wrel}[3]{#1 \colon {\color{blue}#2} \triangleright {\color {blue} #3}}
\newcommand{\ok}[1]{{\color{blue} #1} \texttt{ Ok}}
\newcommand\okt[0]{\texttt{Ok}}
\renewcommand\i[0]{\iota}
\newcommand\w{\omega}
\newcommand\dom[1]{\texttt{dom}(#1)}
\newcommand\x{\times}


\newcommand\fev[1]{fev(#1)}
\newcommand\union[0]{\cup}


% Combinators to build tree proofs
\newcommand{\truleconst}[0]{\ntreeruleI{\vconst}{\ok{\G}}{\gtyperelation{\const{A}}{A}}}
\newcommand{\truleunit}[0]{\ntreeruleI{\vunit}{\ok{\G}}{\typerelation{\G}{\u}{\U}}}
\newcommand{\truletrue}[0]{\ntreeruleI{\vtrue}{\ok{\G}}{\typerelation{\G}{\t}{\B}}}
\newcommand{\trulefalse}[0]{\ntreeruleI{\vfalse}{\ok{\G}}{\typerelation{\G}{\f}{\B}}}


\newcommand{\E}[0]{\mathbb{E}}
\renewcommand{\dot}{\cdot}
\newcommand{\gens}[0]{\colon\colon=}
\newcommand{\nil}[0]{\diamond}
\newcommand{\ground}[0]{\gamma}

% Terminal object of C
\newcommand{\terminal}[0]{\texttt{\1}}

% The category C
\newcommand{\C}[0]{\mathbb{C}}
\newcommand{\Cz}[0]{\C_0}
\newcommand\DC[0]{\mathbb{D}}

% The category of locally-small categories
\newcommand{\Cat}[0]{\texttt{Cat}}
% Sub-effect Nat-trans
\newcommand{\dse}[2]{\db{#1 \subeffect #2}}

\newcommand\app[0]{\texttt{app}}
\newcommand\cur[1]{\texttt{cur}(#1)}
\newcommand{\ifnt}[1]{\texttt{If}_{#1}}


\newcommand{\setto}{\colon=}
\newcommand{\fv}[1]{\texttt{fv}(#1)}

% shorthand for inserting text to equations
\newcommand\qt[1]{\quad\text{#1}}

% Co-product short-hands
\newcommand\inr[0]{\texttt{inr}}
\newcommand\inl[0]{\texttt{inl}}
    
\newcommand\fld[2]{[#1,#2]}
\newcommand{\diag}[1]{\delta_{#1}}
\newcommand{\twist}[2]{\tau_{#1, #2}}

\newcommand\ifMorph[3]{\app\after((\fld{\cur{#2\after\pp}}{\cur{#3\after\pp}}\after #1)\times \idg)\after \diag{\G}}


% Polymorphic short-hands
\newcommand\elam[2]{\Lambda #1. #2}
\newcommand{\eapp}[2]{#1\s#2}
\renewcommand{\a}[0]{\alpha}
\newcommand{\all}[2]{\forall #1. #2}
\renewcommand{\P}[0]{\Phi}

\renewcommand{\b}[0]{\beta}
\newcommand{\g}[0]{\gamma}
\renewcommand\d[0]{\delta}
\newcommand\oke[2]{\wellformedok{#1}{#2}}
\newcommand\etyperelation[4]{\typerelation{#1\mid#2}{#3}{#4}}
\newcommand{\gpetyperelation}[2]{\etyperelation{\P}{\G}{#1}{#2}}
\newcommand{\gppetyperelation}[2]{\etyperelation{\P'}{\G}{#1}{#2}}


\newcommand{\eberelation}[5]{\berelation{#1\mid#2}{#3}{#4}{#5}}
\newcommand{\gpeberelation}[3]{\berelation{\P\mid\G}{#1}{#2}{#3}}
\newcommand{\gppeberelation}[3]{\berelation{\P'\mid\G}{#1}{#2}{#3}}

\newcommand{\dotp}[0]{\dot_\P}
\newcommand{\fntype}[2]{#1\rightarrow #2}
\newcommand{\ab}[0]{\fntype{A}{B}}

\newcommand\wrelw[2]{\wrel{\w}{#1}{#2}}
\renewcommand\proof[0]{\paragraph{Proof:}}
\newcommand{\case}[1]{\paragraph{Case #1:}}
\newcommand{\subcase}[1]{\subparagraph{Case: #1}}
\newcommand\bi[0]{By inversion}

%pre-filled effect-weakening relations
\newcommand\ewrel[4]{\wellformed{#1}{\color{black}\wrel{#2}{#3}{#4}}}
\newcommand\pewrel[3]{\ewrel{\P}{#1}{#2}#3}
\newcommand\ppewrel[3]{\ewrel{\P'}{#1}{#2}#3}

\newcommand\subtypep[0]{\subtype_\P}
\newcommand\subtypepp[0]{\subtype_{\P'}}
\newcommand\subeffectp[0]{\subeffect_{\P}}
\newcommand\subeffectpp[0]{\subeffect_{\P'}}
\newcommand\subeffectn[0]{\subeffect_{n}}
\newcommand\subeffectz[0]{\subeffect_{0}}

\newcommand{\allI}[0]{\forall_I}
\newcommand{\allII}[0]{\forall_{I'}}
\newcommand\allIU[0]{\forall_{I\times U}}
\newcommand\type[0]{\texttt{Type}}
\newcommand\effect[0]{\texttt{Effect}}
\newcommand\ciw[0]{\C(I, W)}
\newcommand\ciu[0]{\C(I, U)}
\newcommand\ciuw[0]{\C(I\times U, W)}
\newcommand\cipw[0]{\C(I', W)}
\newcommand\cipu[0]{\C(I', U)}
\newcommand\ciuu[0]{\C(I\times U, U)}
\newcommand\cii[0]{\C(I', I)}
\newcommand\Eff[0]{\texttt{Eff}}
\newcommand\Mul[0]{\texttt{Mul}}
\newcommand\singleton[0]{\ast}
\renewcommand\star[0]{^*}
\renewcommand\bar[1]{\overline{#1}}

\newcommand\subtypeg[0]{\subtype_\g}
\newcommand\subtypepa[0]{\subtype_{\P, \a}}
\newcommand\subtypeppa[0]{\subtype_{\P', \a}}

\newcommand\subtypez[0]{\subtype_{0}}
\newcommand\subtypen[0]{\subtype_{n}}

\usepackage{scalerel,stackengine}
\stackMath
\renewcommand\widehat[1]{%
\savestack{\tmpbox}{\stretchto{%
  \scaleto{%
    \scalerel*[\widthof{\ensuremath{#1}}]{\kern.1pt\mathchar"0362\kern.1pt}%
    {\rule{0ex}{\textheight}}%WIDTH-LIMITED CIRCUMFLEX
  }{\textheight}% 
}{2.4ex}}%
\stackon[-6.9pt]{#1}{\tmpbox}%
}
\parskip 1ex

\newcommand\pstar[0]{\p\star}

\newcommand\edeltavrule[5]{\deltavrule{#1 \mid #2}{#3}{#4}{#5}}

\newcommand\subeffecttreep[4]{\ntreeruleII{\teffect}{
    #1\subeffectp #3}{#2 \subtypep #4
}{\M{#1}{
    #2
}\subtypep\M{#3}{#4}}}
\newcommand\subeffecttree[4]{\ntreeruleII{\teffect}{
    #1\subeffect #3}{#2 \subtype #4
}{\M{#1}{
    #2
}\subtype\M{#3}{#4}}}


\newcommand{\edeltavruleprime}[5]{
        \deltavruleprime{#1\mid #2}{#3}{#4}{#5}}
    
\newcommand{\edeltavruleprimeprime}[5]{
        \deltavruleprimeprime{#1\mid #2}{#3}{#4}{#5}}
    
\newcommand{\edeltacrule}[6]{
            \ntreeruleII{\vsubtype}{
                \treeruleI{
                    \D
                }{
                    \typerelation{\P\mid#1}{#2}{\M{#3}{#4}}
                }
            }{
                \ntreeruleII{\teffect}{
                    #4 \subtypep #6
                    }{
                         #3 \subeffectp #5
                }{
                    \M{#3}{#4}\subtypep{\M{#5}{#6}}
                }
            }{
                \typerelation{\P\mid #1}{#2}{\M{#5}{#6}}
            }
        }
        

        \newcommand{\edeltacruleprime}[6]{
            \ntreeruleII{\vsubtype}{
                \treeruleI{
                    \D'
                }{
                    \typerelation{\P\mid #1}{#2}{\M{#3}{#4}}
                }
            }{
                \ntreeruleII{\teffect}{
                    #4 \subtypep #6
                }{#3 \subeffectp #5
                }{
                    \M{#3}{#4}\subtypep{\M{#5}{#6}}
                }
            }{
                \typerelation{\P\mid #1}{#2}{\M{#5}{#6}}
            }
        }
                   

        \newcommand{\edeltacruleprimeprime}[6]{
            \ntreeruleII{\vsubtype}{
                \treeruleI{
                    \D''
                }{
                    \typerelation{\P\mid #1}{#2}{\M{#3}{#4}}
                }
            }{
                \ntreeruleII{\teffect}{
                    #4 \subtypep #6
                    }{ #3 \subeffectp #5
                }{
                    \M{#3}{#4}\subtypep{\M{#5}{#6}}
                }
            }{
                \typerelation{\P\mid #1}{#2}{\M{#5}{#6}}
            }
        }

        \newcommand\obj[0]{\texttt{obj }}


        \newcommand{\Tz}[2]{\texttt{T}^0_{#1}#2}
        \newcommand{\Tn}[2]{\texttt{T}^n_{#1}#2}
        \newcommand{\Tm}[2]{\texttt{T}^m_{#1}#2}
        
        \newcommand{\pointz}[1]{\point{#1}^0}
        \newcommand{\pointn}[1]{\point{#1}^n}
        \newcommand{\pointm}[1]{\point{#1}^m}
        
        \newcommand{\bindz}[3]{\bind{#1}{#2}{#3}^0}
        \newcommand{\bindn}[3]{\bind{#1}{#2}{#3}^n}
        \newcommand{\bindm}[3]{\bind{#1}{#2}{#3}^m}
        
        \newcommand\tstrengthz[3]{\tstrength{#1}{#2}{#3}^0}
        \newcommand\tstrengthn[3]{\tstrength{#1}{#2}{#3}^n}
        \newcommand\tstrengthm[3]{\tstrength{#1}{#2}{#3}^m}
        
        \newcommand\set[0]{\texttt{Set}}
        \newcommand\cccat[0]{\textit{CCCat}}

        \newcommand\ev[0]{\vec{\e}}
        \newcommand\emv[0]{\vec{\e_m}}
        \newcommand\env[0]{\vec{\e_n}}
        
        \newcommand\subeffectm[0]{\subeffect_m}
        
        \newcommand\dsem[2]{\db{#1 \subeffectm #2}}
        \newcommand\dsen[2]{\db{#1 \subeffectn #2}}
        \newcommand\dsez[2]{\db{#1 \subeffectz #2}}
        \newcommand\dsep[2]{\db{#1 \subeffectp #2}}
        \newcommand\dsepp[2]{\db{#1 \subeffectpp #2}}
        
        \newcommand\allEn[0]{\forall_{E^n}}
        \newcommand\allEm[0]{\forall_{E^m}}
        
        \newcommand\counit[1]{\boldsymbol{\epsilon}_{#1}}
        \newcommand\unit[1]{\boldsymbol{\eta}_{#1}}


        
%% Adequacy shorthands
\newcommand{\relates}[0]{\lhd}
\newcommand{\logRel}[3]{#1 \relates_{#2} #3}
\newcommand{\plogRel}[4]{#1 \relates_{\wellformed{#2}{#3}} #4}

\newcommand{\zberelation}[3]{\berelation{}{#1}{#2}{#3}}
\newcommand\ztyperelation[2]{\typerelation{}{#1}{#2}}

\newcommand{\N}[0]{\mathbb{N}}
\renewcommand\put[0]{\texttt{put}}
\newcommand\ecput[0]{\texttt{EC}_\put}
\newcommand\ecputA[0]{\texttt{EC}_\put^A}
\newcommand\ecputG[0]{\texttt{EC}_\put^G}

\newcommand\mna[0]{\M{n}{A}}
\newcommand\mmb[0]{\M{m}{B}}
\newcommand\mnb[0]{\M{n}{B}}
\newcommand\mma[0]{\M{m}{A}}

\newcommand{\setcomp}[2]{\{#1 \mid #2 \}}

\newcommand{\pecput}[0]{\texttt{PEC}_\put}
\newcommand{\pecputA}[0]{\texttt{PEC}_\put^{\wellformedt{\P}{A}}}
\newcommand{\pecputG}[0]{\texttt{PEC}_\put^{\wellformedok{\P}{\G}}}

\newcommand{\zptyperelation}[2]{\typerelation{\P}{#1}{#2}}
\newcommand{\zpberelation}[2]{\berelation{\P}{#1}{#2}}

\newcommand{\fapply}[0]{^E}
\newcommand\liftp[0]{^\pi}
\newcommand{\pe}[0]{\pi_\e}



\usepackage[mathscr]{euscript}
\let\euscr\mathscr \let\mathscr\relax
\usepackage[scr]{rsfso}
\newcommand{\powerset}{\raisebox{.15\baselineskip}{\Large\ensuremath{\wp}}}
\newcommand\erelates[2]{\texttt{R}_{\wellformedt{#1}{#2}}}
\newcommand\erelatesg[2]{\texttt{R}_{\wellformedok{#1}{#2}}}
\newcommand\powset[1]{\powerset(#1)}
\newcommand{\av}[0]{\vec{\a}}

\newcommand\inLogRel[5]{(#1, #2)\in\erelates{#3}{#4}(#5)}
\newcommand\inLogRelE[4]{\inLogRel{#1}{#2}{#3}{#4}{\ev}}
\newcommand{\inLogRelPE}[3]{\inLogRelE{#1}{#2}{\P}{#3}}
\newcommand{\inLogRelPEG}[3]{({#1}{#2})\in\erelatesg{\P}{#3}(\ev)}
\newcommand\fundSub[0]{\ssub{\av}{\ev}\ssi}
\newcommand\fundRho[0]{(\ev)(\rho)}
\newcommand\fundRhoExt[1]{(\ev)(\rho#1)}
\fi